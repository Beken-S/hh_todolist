<html>
<head>
<title>ToDo List</title>
<!--author>Bannov Daniil</author-->
<script src="https://code.jquery.com/jquery-1.6.4.js"></script>
<style>
div{
  margin: 10px;
  padding-left: 10px;
  padding-right: 30px;
}
.displayall{
  border: 1px solid black;
  width:900px;
  overflow-y: scroll;
  height:400px;
  box-sizing: border-box;
  padding-top: 20px;
}
.taskpanel, .editpanel{
  display: inline-block;
  border: 1px solid black;
  border-width:1px;
  border-style:solid;
  border-color:black;
}
.but{
  margin-left: 4px;
  margin-right: 4px;
}
span{ 
 margin: 4px;
 padding: 2px;
}
.workitem{
 display: table-row;
 background-color: #99ffcc;
}
.compliteditem{
  display: table-row;
  background-color: #ff99cc;
}
.row{
  display: table-row;
}
.col{
	text-align: left;
	display: table-cell;
	padding: 10px;
	border: 1px solid #555;
 white-space: nowrap;
 overflow:hidden;
} 
.colname{
width: 200px;
	text-align: left;
	display: table-cell;
	padding: 10px;
	border: 1px solid #555;
} 
</style>                                    
</head>

<body>
<div class="displayall"></div>
<div class="buttondiv">
<button class="showall" type="button" OnClick="getAllTask();">Show All</button>
<button class="showAct" type="button" OnClick="getAllStatusTask('ACTIVE');">Show ACTIVE</button>
<button class="showwork" type="button" OnClick="getAllStatusTask('WORK');">Show WORK</button>
<button class="showcoml" type="button" OnClick="getAllStatusTask('COMPLETED');">Show COMPLETED</button>
<span style="margin-left:300px; align: left;">
<button class="addtask" style="width: 100px; background-color: #66eecc; font-weight: bold; height: 50px;" type="button" OnClick="getAddTask();">Add Task</button>
</span>
</div>
<div class="taskpanel" ></div>
<div class="editpanel" ></div>

    <script>
function editTask(n){
	getTask(n);

    $.getJSON('http://localhost:8080/api/v1/get/'+n, function(data) {
        var taskname = data.taskName.replace(/\"/g, '&quot;');
var as ="selected";
var cs ="";
var ws ="";
switch(data.taskStatus) {
 case 'COMPLETED':
	var cs ="selected";
	var as ="";
  break;
 case 'WORK':
	var ws ="selected";
	var as ="";
  break;

}
        var text = `<form id="tip" method="POST" name="edit${n}" style="display:inline!important; margin: 0; padding: 0;">
	<input type="hidden" name="_method" value="put" />
		ID: ${n}<input type="hidden" value="${n}" name = "id"><br>
		Task Name: <input type="text" value="${taskname}" name = "task"><br>
		Task Status:
		<select name="status" id="status-select">
    			<option value="ACTIVE" ${as}>ACTIVE</option>
  			<option value="COMPLETED" ${cs}>COMPLETED</option>
  			<option value="WORK" ${ws}>WORK</option>
		</select>
	<br><br>
  <input type="submit" name="send" value="Edit" OnClick="return sendEditTask(${n});">

</form>
`


        $(".editpanel").html(text);
    });
}
function sendEditTask(vid){
    var form = document.getElementById('tip');

    var id = form.id.value;
    var taskname = form.task.value;
    var status = form.status.value;
    $.ajax({
        url: "http://localhost:8080/api/v1/update/"+id,
        type : "PUT",
        data: 
        {  
           'task' : taskname,
           'status' :status
        },
        cache:false,
        success: function (html) 
        {
           $(".taskpanel").html('Data Send');
           $(".editpanel").html('');
  		getAllTask();
        }
    });
return false;
}

function deleteTask(n){
    $.ajax({
	url: 'http://localhost:8080/api/v1/delete/'+n,
	type: 'DELETE',
	success: function(result) {                      
	        var text = `task ID: ${n} deleted.`
        	$(".taskpanel").html(text);
        	getAllTask();
	 }
	}  );
}

function getTask(n){
    $.getJSON('http://localhost:8080/api/v1/get/'+n, function(data) {

        var text = `ID: ${data.id}<br>
                    Create time: ${data.taskTime}<br>
                    Task name: ${data.taskName}<br>
                    Status: ${data.taskStatus}<br>`


        $(".taskpanel").html(text);
    });
}

function getAllTask(){
    $.getJSON('http://localhost:8080/api/v1/getAll/', function(data) {
    var text = '<div class="row"><span class="col">ID</span><span class="col">Create time</span><span class="col">Status</span><span class="colname">Task Name</span><span class="col">Action</span></div>';   
    for (var i = 0; i < data.length; i++) {
        var classStyle = "row";
        if(data[i].taskStatus === "COMPLETED"){
          classStyle = "compliteditem";
        }
        if(data[i].taskStatus === "WORK"){
          classStyle = "workitem";
        }
         text = text + `<div class="${classStyle}">
                    <span class="col">${data[i].id}</span>
                    <span class="col">${data[i].taskTime.replace("T", " ")}</span>
                    <span class="col">${data[i].taskStatus}</span>
                    <span class="colname">${data[i].taskName} </span>
                    <span class="col">
                    <button class="but" id="id${data[i].id}" type="button" OnClick="getTask(${data[i].id});">Show[${data[i].id}]</button>
                    <button class="but" id="delete${data[i].id}" type="button" OnClick="deleteTask(${data[i].id});">Delete[${data[i].id}]</button>
                    <button class="but" id="edit${data[i].id}" type="button" OnClick="editTask(${data[i].id});">Edit[${data[i].id}]</button>
                    </span></div>`

     }
        $(".displayall").html(text);
    });
}

function getAllStatusTask(status){
    $.getJSON('http://localhost:8080/api/v1/getAll?status='+status, function(data) {
    var text = '<div class="row"><span class="col">ID</span><span class="col">Create time</span><span class="col">Status</span><span class="colname">Task Name</span><span class="col">Action</span></div>';   
    for (var i = 0; i < data.length; i++) {
        var classStyle = "row";
        if(data[i].taskStatus === "COMPLETED"){
          classStyle = "compliteditem";
        }
        if(data[i].taskStatus === "WORK"){
          classStyle = "workitem";
        }
         text = text + `<div class="${classStyle}">
                    <span class="col">${data[i].id}</span>
                    <span class="col">${data[i].taskTime.replace("T", " ")}</span>
                    <span class="col">${data[i].taskStatus}</span>
                    <span class="colname">${data[i].taskName} </span>
                    <span class="col">
                    <button class="but" id="id${data[i].id}" type="button" OnClick="getTask(${data[i].id});">Show[${data[i].id}]</button>
                    <button class="but" id="delete${data[i].id}" type="button" OnClick="deleteTask(${data[i].id});">Delete[${data[i].id}]</button>
                    <button class="but" id="edit${data[i].id}" type="button" OnClick="editTask(${data[i].id});">Edit[${data[i].id}]</button>
                    </span></div>`

     }
        $(".displayall").html(text);
    });
}
    </script>

<script>
getAllTask();

</script>
</body>